<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ghostlet — Blooks</title>
<style>
:root{--glow:#ff6aff}
body{margin:0;font-family:Segoe UI,Arial;background:linear-gradient(180deg,#0d0d1a,#1a1a2e);color:#eee}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:#242444;box-shadow:0 0 12px var(--glow);border-bottom:2px solid var(--glow);position:sticky;top:0;z-index:100}
.brand{color:var(--glow);font-weight:800;text-decoration:none}
.container{max-width:1100px;margin:12px auto;padding:0 18px}
.h1{color:var(--glow);font-size:1.6rem;margin:12px 0}
.pack-section{margin-top:18px}
.pack-title{font-weight:800;font-size:1.35rem;color:var(--glow);margin-bottom:10px;border-bottom:1px solid rgba(255,106,255,0.06);padding-bottom:6px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
.card{background:#2b2b44;padding:12px;border-radius:12px;text-align:center;border:2px solid rgba(255,106,255,0.06)}
.card img{width:100%;height:120px;object-fit:contain;border-radius:8px}
.blook-row{display:flex;gap:12px;align-items:center;padding:8px 10px;background:#232336;border-radius:10px;margin-bottom:8px}
.blook-thumb{width:56px;height:56px;border-radius:8px;object-fit:cover}
.blook-info{flex:1}
.blook-name{font-weight:800}
.blook-meta{color:#ccc;font-size:0.9rem}
.empty{color:#aaa;padding:22px;text-align:center}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="topbar">
    <a class="brand" href="home.html">Ghostlet</a>
    <div>
      <button onclick="location.href='stats.html'">Stats</button>
      <button onclick="location.href='chat.html'">Chat</button>
      <button onclick="location.href='market.html'">Market</button>
      <button onclick="location.href='blooks.html'">Blooks</button>
      <button onclick="location.href='settings.html'">Settings</button>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="container">
    <div class="h1">Your Blooks</div>
    <div id="blooksContainer"></div>
    <div id="empty" class="empty hidden">You don't have any Blooks yet — open packs in Market!</div>
  </div>

<script>
/* FIREBASE (same config) */
const firebaseConfig = {
  apiKey: "AIzaSyBLPQtq39tEcha66rw_ovWa5-I3Nl1qyos",
  authDomain: "ghostlet-98357.firebaseapp.com",
  projectId: "ghostlet-98357",
  storageBucket: "ghostlet-98357.appspot.com",
  messagingSenderId: "843012219969",
  appId: "1:843012219969:web:9e3037578726debf2212c0"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

document.getElementById('logoutBtn').addEventListener('click', ()=> auth.signOut().then(()=> location.href='login.html').catch(()=>{}));

const PACK_ORDER = ['OG','Spooky','Holiday','Emoji']; // show in this order

auth.onAuthStateChanged(user=>{
  if(!user) return window.location.href = 'login.html';
  const uid = user.uid;
  const container = document.getElementById('blooksContainer');

  // Listen to user's blooks collection
  db.collection('users').doc(uid).collection('blooks')
    .onSnapshot(snapshot => {
      const byPack = {};
      snapshot.forEach(doc => {
        const d = doc.data();
        const packName = d.packName || 'Other';
        if(!byPack[packName]) byPack[packName] = [];
        byPack[packName].push(d);
      });

      // render
      container.innerHTML = '';
      const packsShown = new Set();

      // show packs in pack order
      PACK_ORDER.forEach(pack => {
        if(byPack[pack] && byPack[pack].length){
          packsShown.add(pack);
          const section = document.createElement('div');
          section.className = 'pack-section';
          section.innerHTML = `<div class="pack-title">${pack}</div>`;
          const grid = document.createElement('div');

          byPack[pack].forEach(b => {
            const row = document.createElement('div'); row.className='blook-row';
            row.innerHTML = `
              <img class="blook-thumb" src="${b.image || 'https://i.ibb.co/0FQG7kF/friendly-ghost.png'}" alt="${b.name}">
              <div class="blook-info">
                <div class="blook-name">${b.name}</div>
                <div class="blook-meta">${b.rarity || 'Unknown'} • Owned: ${b.count || 1}</div>
              </div>
            `;
            section.appendChild(row);
          });

          container.appendChild(section);
        }
      });

      // show any other packs (not in PACK_ORDER)
      Object.keys(byPack).forEach(pack => {
        if(packsShown.has(pack)) return;
        const section = document.createElement('div'); section.className='pack-section';
        section.innerHTML = `<div class="pack-title">${pack}</div>`;
        byPack[pack].forEach(b => {
          const row = document.createElement('div'); row.className='blook-row';
          row.innerHTML = `
            <img class="blook-thumb" src="${b.image || 'https://i.ibb.co/0FQG7kF/friendly-ghost.png'}" alt="${b.name}">
            <div class="blook-info">
              <div class="blook-name">${b.name}</div>
              <div class="blook-meta">${b.rarity || 'Unknown'} • Owned: ${b.count || 1}</div>
            </div>
          `;
          section.appendChild(row);
        });
        container.appendChild(section);
      });

      if(snapshot.size === 0){
        document.getElementById('empty').classList.remove('hidden');
      } else {
        document.getElementById('empty').classList.add('hidden');
      }
    }, err => {
      console.error('blooks onSnapshot error', err);
      container.innerHTML = '<div class="empty">Failed to load your Blooks — check console.</div>';
    });
});
</script>
</body>
</html>
